<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sourdough Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  <!-- Chart.js for graphing -->
    <style>
        body {
            display: flex;
            justify-content: space-between;
            padding: 20px;
        }
        .input-container {
            display: flex;
            flex-direction: column;
            width: 40%;
        }
        .graph-container {
            width: 55%;
        }
        input {
            margin-bottom: 10px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div class="input-container">
        <h2>Starter Data</h2>
        
        <label for="grams starter">Grams of Starter (g):</label>
        <input type="number" id="S" placeholder="Enter grams of starter (g)" step="0.01" oninput="calculatePercentages()">
        
        <label for="grams AP">Grams of AP Flour (g):</label>
        <input type="number" id="AP" placeholder="Enter grams of AP flour (g)" step="0.01" oninput="calculatePercentages()">
        
        <label for="grams WW">Grams of Other Flour (g):</label>
        <input type="number" id="WW" placeholder="Enter grams of other types of flour (g)" step="0.01" oninput="calculatePercentages()">
        
        <!-- Removed the Grams of Water input field as requested -->
        
        <label for="IT">Initial Temperature (F째):</label>
        <input type="number" id="IT" placeholder="Enter initial temperature (F째)" step="0.01">
        
        <label for="AT">Ambient Temperature (F째):</label>
        <input type="number" id="AT" placeholder="Enter ambient temperature (F째)">
        
        <label for="A">Activity Level of Starter (0-4):</label>
        <input type="number" id="A" placeholder="Enter activity level of starter on a scale from 0-4">
        
        <label for="tMax">Max Time (t):</label>
        <input type="number" id="tMax" placeholder="Enter maximum time for the graph (e.g. 100)" step="1">

        <p id="starterPercentage">Starter Percentage: N/A</p>
        <p id="otherFlourPercentage">Other Flour Percentage: N/A</p>

        <button onclick="generateGraph()">Generate Graph</button>
    </div>
    <div class="graph-container">
        <canvas id="logisticGraph"></canvas>
    </div>

    <script>
        const coefficientsMatrix = [
            [-39.8464290533585, 0.439110177177445, -0.0236465746771963, 0.0169817435690994, 6.07257889928508, 1.33653549298473, -4.28698519043463], // K coefficients
            [10.4109848297146, -0.122773174855113, 0.000642182792801124, -0.00517530121138070, 0.250748424946177, 0.0733600347460909, -1.05054426204847], // r coefficients
            [-96.3899669516444, 0.780672472241403, -0.0768608461664437, 0.0443050687521287, 14.0952183134734, 9.18135325752611, 1.00581702407497] // P0 coefficients
        ];

        function logisticFunction(r, K, P0, t) {
            return K / (1 + Math.exp(-r * (t - P0)));
        }

        // Function to calculate percentages and update the display
        function calculatePercentages() {
            const S = parseFloat(document.getElementById('S').value) || 0;
            const AP = parseFloat(document.getElementById('AP').value) || 0;
            const WW = parseFloat(document.getElementById('WW').value) || 0;

            const totalFlour = AP + WW;

            if (totalFlour > 0) {
                const starterPercentage = (S / totalFlour) * 100;
                const otherFlourPercentage = (WW / totalFlour) * 100;

                document.getElementById('starterPercentage').textContent = `Starter Percentage: ${starterPercentage.toFixed(2)}%`;
                document.getElementById('otherFlourPercentage').textContent = `Other Flour Percentage: ${otherFlourPercentage.toFixed(2)}%`;
            } else {
                document.getElementById('starterPercentage').textContent = `Starter Percentage: N/A`;
                document.getElementById('otherFlourPercentage').textContent = `Other Flour Percentage: N/A`;
            }
        }

        function generateGraph() {
            // Get input values
            const S = parseFloat(document.getElementById('S').value);
            const AP = parseFloat(document.getElementById('AP').value);
            const WW = parseFloat(document.getElementById('WW').value);
            const IT = parseFloat(document.getElementById('IT').value);
            const AT = parseFloat(document.getElementById('AT').value);
            const A = parseFloat(document.getElementById('A').value);

            // Validate inputs
            if (isNaN(S) || isNaN(AP) || isNaN(WW) || isNaN(IT) || isNaN(AT) || isNaN(A)) {
                alert("Please fill out all input fields.");
                return;
            }

            // Fixed total volume and starter concentration
            const totalVolume = 200;
            const starterConcentration = S / (AP + WW);
            const percentOtherFlour = WW / (AP + WW);

            // Create an input array matching the matrix order
            const inputs = [1, IT, AT, totalVolume, starterConcentration, A, percentOtherFlour];

            // Matrix multiplication to calculate K, r, and P0
            const K = inputs.reduce((sum, value, i) => sum + value * coefficientsMatrix[0][i], 0);
            const r = inputs.reduce((sum, value, i) => sum + value * coefficientsMatrix[1][i], 0);
            const P0 = inputs.reduce((sum, value, i) => sum + value * coefficientsMatrix[2][i], 0);

            // Check for missing or invalid results
            if (isNaN(K) || isNaN(r) || isNaN(P0)) {
                alert("Please enter valid values.");
                return;
            }

            // Get the max time (tMax) and validate it
            const tMax = parseInt(document.getElementById('tMax').value);
            if (isNaN(tMax) || tMax <= 0) {
                alert("Please enter a valid value for the maximum time (t).");
                return;
            }

            // Prepare to graph
            const tValues = [];
            const pValues = [];

            // Logistic function calculation
            for (let t = 0; t <= tMax; t++) {
                tValues.push(t);
                pValues.push(logisticFunction(r, K, P0, t));
            }

            // Get the canvas and its context
            const canvas = document.getElementById('logisticGraph');
            const ctx = canvas.getContext('2d');

            // If there's an existing chart, destroy it before creating a new one
            if (window.chartInstance) {
                window.chartInstance.destroy();
            }

            // Create the new chart
            window.chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: tValues,
                    datasets: [{
                        label: 'Logistic Growth',
                        data: pValues,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time (t)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Percent Growth (%)'
                            }
                        }
                    }
                }
            });

            console.log('Chart created successfully!');
        }

    </script>
</body>
</html>
